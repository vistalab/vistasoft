function b_file_name = mrtrix_bfileFromBvecs(bvecs_file, bvals_file, b_file_name)

% 
% function mrtrix_bfileFromBvecs(bvecs_file, bvals_file, b_file_name)     
%
% Generate mrtrix compatible gradient file. 
% 
% Parameters
% ----------
% bvecs_file: string, full path to a file containing bvecs, generated by 
%             dtiInit
% 
% bvals_file: string, full path to a file containing the bvals, generated
%             by dtiInit  
%
% b_file_name: full path to where the file should be written. 
% Optional, if not provided, a file will be generated in the pwd, named
% "encoding.b" 
% 
% Returns
% -------
% b_file_name: full path to the file generated. If failed to run through,
% will return false. 
% 
% Notes
% -----
% For details on the file-format, see: 
% http://www.brain.org.au/software/mrtrix/tractography/dwi.html

if notDefined('b_file_name')
    b_file_name = [fullpath(pwd), '/encoding.b']; 
end 

% Open the file for writing: 
fid = fopen(b_file_name,'w'); 

% Read information from files: 
bvecs = dlmread(bvecs_file); 
bvals = dlmread(bvals_file); 

% 
format = '%1.6f\t %1.6f\t %1.6f\t %1.6f\n'; 

for i=1:length(bvals)
    fprintf(fid,format,[bvecs(:,i)', bvals(i)]);    
end 

fclose(fid); 
    